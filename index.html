<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JUJUTSU KAISEN: DOMAIN CLASH - ENHANCED</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Rajdhani:wght@300;500;700&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Rajdhani', sans-serif; background: #050505; color: #fff; overflow: hidden; user-select: none; }
        #bgCanvas { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; transition: background 0.5s; }
        .container { max-width: 1400px; margin: 0 auto; padding: 20px; }
        
        /* Mode Selection */
        #modeScreen { min-height: 100vh; display: flex; flex-direction: column; align-items: center; justify-content: center; animation: fadeIn 0.5s ease; }
        .title { font-family: 'Orbitron', sans-serif; font-size: 4em; font-weight: 900; letter-spacing: 6px; margin-bottom: 10px; background: linear-gradient(135deg, #ff0844, #ffb199, #ff0844); -webkit-background-clip: text; -webkit-text-fill-color: transparent; animation: titleGlow 2s ease-in-out infinite; text-align: center; }
        .subtitle { font-size: 1.5em; color: #aaa; margin-bottom: 40px; letter-spacing: 3px; }
        @keyframes titleGlow { 0%, 100% { filter: drop-shadow(0 0 20px rgba(255, 8, 68, 0.5)); } 50% { filter: drop-shadow(0 0 40px rgba(255, 8, 68, 0.8)); } }
        
        .modes-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; width: 100%; max-width: 1000px; margin-bottom: 20px; }
        .mode-card { background: linear-gradient(135deg, rgba(30, 10, 20, 0.95), rgba(50, 10, 30, 0.95)); border: 2px solid rgba(255, 8, 68, 0.3); border-radius: 15px; padding: 30px 20px; cursor: pointer; transition: 0.2s; text-align: center; }
        .mode-card:hover { transform: translateY(-5px); border-color: #ff0844; box-shadow: 0 5px 30px rgba(255, 8, 68, 0.6); }
        .mode-icon { font-size: 3em; margin-bottom: 10px; }
        .mode-name { font-weight: 900; font-size: 1.3em; color: #ff0844; margin-bottom: 5px; }
        .mode-desc { font-size: 0.9em; color: #aaa; }
        
        /* Character Selection */
        #selectionScreen { display: none; min-height: 100vh; flex-direction: column; align-items: center; justify-content: center; animation: fadeIn 0.5s ease; }
        .selection-header { text-align: center; margin-bottom: 20px; }
        .characters-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); gap: 15px; width: 100%; max-width: 1200px; max-height: 60vh; overflow-y: auto; padding: 20px; background: rgba(20, 0, 10, 0.8); border: 2px solid rgba(255, 8, 68, 0.3); border-radius: 20px; backdrop-filter: blur(10px); }
        .character-card { background: linear-gradient(135deg, rgba(30, 10, 20, 0.95), rgba(50, 10, 30, 0.95)); border: 1px solid rgba(255, 8, 68, 0.3); border-radius: 12px; padding: 15px; cursor: pointer; transition: 0.2s; text-align: center; position: relative; overflow: hidden; }
        .character-card:hover { transform: translateY(-5px); border-color: #ff0844; box-shadow: 0 5px 20px rgba(255, 8, 68, 0.4); }
        .character-card.selected { border: 3px solid #00ff88; box-shadow: 0 0 20px rgba(0, 255, 136, 0.5); }
        .character-portrait { font-size: 3em; margin-bottom: 5px; }
        .character-name { font-weight: 900; font-size: 1em; color: #ff0844; margin-bottom: 2px; }
        .character-title { font-size: 0.7em; color: #aaa; font-style: italic; }
        .domain-badge { position: absolute; top: 5px; right: 5px; font-size: 0.7em; background: #ffd700; color: #000; padding: 2px 6px; border-radius: 4px; font-weight: bold; }

        /* Map Selection */
        #mapScreen { display: none; min-height: 100vh; flex-direction: column; align-items: center; justify-content: center; }
        .maps-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 20px; max-width: 1000px; margin: 20px; }
        .map-card { background: rgba(20, 20, 20, 0.9); border: 2px solid #555; border-radius: 10px; padding: 20px; cursor: pointer; transition: 0.2s; text-align: center; }
        .map-card:hover { border-color: #ff0844; transform: translateY(-3px); }
        .map-card.selected { border-color: #00ff88; box-shadow: 0 0 20px rgba(0, 255, 136, 0.5); }
        .map-preview { font-size: 4em; margin-bottom: 10px; }
        .map-name { font-size: 1.2em; font-weight: bold; color: #ff0844; }

        /* Game Screen */
        #gameScreen { display: none; width: 100%; height: 100vh; position: relative; }
        #gameCanvas { display: block; width: 1200px; height: 600px; background: rgba(0,0,0,0.5); border: 4px solid #333; margin: 0 auto; box-shadow: 0 0 60px rgba(0,0,0,0.5); border-radius: 10px; }
        
        .hud { width: 1200px; margin: 10px auto; }
        .top-hud { display: flex; justify-content: space-between; align-items: center; margin-bottom: 5px; }
        .round-info, .coins-display { font-size: 1.5em; font-weight: 900; color: #fff; text-shadow: 0 0 10px rgba(255,255,255,0.5); }
        .combo-display { font-size: 2.5em; font-weight: 900; color: #ffd700; text-shadow: 0 0 15px #ffd700; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); animation: comboPulse 0.3s; pointer-events: none; }
        @keyframes comboPulse { 0% { transform: translate(-50%, -50%) scale(0.5); } 50% { transform: translate(-50%, -50%) scale(1.2); } 100% { transform: translate(-50%, -50%) scale(1); } }
        
        .health-bars { display: flex; justify-content: space-between; gap: 40px; margin-bottom: 10px; }
        .health-group { flex: 1; }
        .health-label { font-size: 1.2em; font-weight: 900; margin-bottom: 5px; display: flex; justify-content: space-between; text-shadow: 2px 2px 0 #000; }
        .health-bar-outer { height: 25px; background: rgba(0,0,0,0.8); border: 2px solid #555; border-radius: 12px; overflow: hidden; position: relative; }
        .health-bar-inner { height: 100%; transition: width 0.2s; }
        .health-bar-inner.player { background: linear-gradient(90deg, #00ff88, #00cc66); }
        .health-bar-inner.enemy { background: linear-gradient(90deg, #ff0844, #ff6b9d); }
        .health-bar-inner.player2 { background: linear-gradient(90deg, #00bfff, #0088ff); }
        .health-bar-inner.enemy2 { background: linear-gradient(90deg, #ff8800, #ffaa00); }
        .ultimate-bar-outer { height: 8px; background: #222; margin-top: 5px; border-radius: 4px; overflow: hidden; }
        .ultimate-bar-inner { height: 100%; background: linear-gradient(90deg, #ffd700, #ffaa00); width: 0%; transition: width 0.2s; }

        .moves-bar { display: grid; grid-template-columns: repeat(6, 1fr); gap: 8px; max-width: 1200px; margin: 5px auto; }
        .move-slot { background: rgba(20,20,20,0.9); border: 1px solid #555; border-radius: 6px; padding: 8px; text-align: center; position: relative; transition: 0.2s; }
        .move-slot.cooldown { border-color: #555; opacity: 0.4; background: #000; }
        .move-slot.ready-ult { border-color: #ffd700; box-shadow: 0 0 15px rgba(255, 215, 0, 0.4); animation: pulse 1s infinite; }
        .move-slot.active { border-color: #00ff88; box-shadow: 0 0 15px rgba(0, 255, 136, 0.6); }
        .move-slot-key { font-size: 0.7em; color: #999; background: #000; padding: 2px 6px; border-radius: 4px; display: inline-block; margin-top: 3px; font-family: monospace; }
        .move-name { font-weight: bold; font-size: 0.8em; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }

        /* Controls Footer */
        .controls-footer { position: fixed; bottom: 10px; left: 50%; transform: translateX(-50%); background: rgba(0,0,0,0.8); padding: 10px 30px; border-radius: 10px; border: 1px solid #555; font-size: 0.9em; text-align: center; }
        .controls-footer span { margin: 0 10px; color: #aaa; }
        .controls-footer b { color: #ff0844; }

        /* Overlays */
        #shopScreen, #gameOver, #tutorialOverlay, #domainOverlay, #tournamentOverlay { display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: rgba(10, 0, 5, 0.98); border: 4px solid #ff0844; border-radius: 20px; padding: 40px; z-index: 100; text-align: center; box-shadow: 0 0 100px rgba(0,0,0,0.9); }
        #domainOverlay { width: 100vw; height: 100vh; background: transparent; border: none; pointer-events: none; z-index: 50; display: none; align-items: center; justify-content: center; }
        #domainText { font-family: 'Orbitron'; font-size: 5em; font-weight: 900; color: #fff; text-shadow: 0 0 30px currentColor; opacity: 0; animation: domainFlash 3s forwards; }
        
        #shopScreen { border-color: #ffd700; width: 800px; max-height: 80vh; overflow-y: auto; }
        .shop-items { display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px; margin: 20px 0; }
        .shop-item { border: 1px solid #ffd700; padding: 15px; cursor: pointer; border-radius: 10px; transition: 0.2s; background: rgba(255, 215, 0, 0.05); }
        .shop-item:hover { background: rgba(255, 215, 0, 0.2); transform: scale(1.02); }
        
        #tournamentOverlay { width: 600px; }
        .tournament-bracket { display: flex; flex-direction: column; gap: 10px; margin: 20px 0; }
        .bracket-match { background: rgba(255, 8, 68, 0.1); padding: 10px; border-radius: 5px; border: 1px solid #555; }
        .bracket-match.completed { opacity: 0.5; }
        .bracket-match.current { border-color: #ffd700; box-shadow: 0 0 15px rgba(255, 215, 0, 0.4); }
        
        button { font-family: 'Orbitron'; font-size: 1.2em; padding: 12px 35px; background: linear-gradient(135deg, #ff0844, #aa0000); border: 2px solid #fff; color: white; cursor: pointer; clip-path: polygon(10% 0, 100% 0, 100% 70%, 90% 100%, 0 100%, 0 30%); margin: 10px; transition: 0.2s; }
        button:hover { transform: scale(1.1); filter: brightness(1.2); }
        button.secondary { background: linear-gradient(135deg, #333, #555); }

        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes pulse { 0% { border-color: #ffd700; } 50% { border-color: #fff; } 100% { border-color: #ffd700; } }
        @keyframes domainFlash { 0% { opacity: 0; transform: scale(0.5); } 20% { opacity: 1; transform: scale(1.2); } 80% { opacity: 1; transform: scale(1); } 100% { opacity: 0; transform: scale(1.5); } }
        
        /* Attack Animations */
        .attack-indicator { position: absolute; pointer-events: none; z-index: 10; animation: attackFlash 0.3s; }
        @keyframes attackFlash { 0% { opacity: 1; transform: scale(0.5); } 100% { opacity: 0; transform: scale(1.5); } }
    </style>
</head>
<body>
    <canvas id="bgCanvas"></canvas>
    
    <div class="container">
        <!-- Mode Selection -->
        <div id="modeScreen">
            <h1 class="title">JUJUTSU KAISEN</h1>
            <p class="subtitle">DOMAIN CLASH - ENHANCED</p>
            <div class="modes-grid">
                <div class="mode-card" onclick="selectMode('1v1')">
                    <div class="mode-icon">‚öîÔ∏è</div>
                    <div class="mode-name">1v1 DUEL</div>
                    <div class="mode-desc">Single battle to the death</div>
                </div>
                <div class="mode-card" onclick="selectMode('2v2')">
                    <div class="mode-icon">ü§ù</div>
                    <div class="mode-name">2v2 CO-OP</div>
                    <div class="mode-desc">Team up against enemies</div>
                </div>
                <div class="mode-card" onclick="selectMode('tournament')">
                    <div class="mode-icon">üèÜ</div>
                    <div class="mode-name">TOURNAMENT</div>
                    <div class="mode-desc">Fight through the bracket</div>
                </div>
                <div class="mode-card" onclick="selectMode('endless')">
                    <div class="mode-icon">‚ôæÔ∏è</div>
                    <div class="mode-name">ENDLESS</div>
                    <div class="mode-desc">Survive as long as you can</div>
                </div>
                <div class="mode-card" onclick="selectMode('survival')">
                    <div class="mode-icon">üíÄ</div>
                    <div class="mode-name">SURVIVAL</div>
                    <div class="mode-desc">Progressive difficulty</div>
                </div>
            </div>
        </div>

        <!-- Character Selection -->
        <div id="selectionScreen">
            <div class="selection-header">
                <h2 style="font-size: 2em; color: #ff0844; margin-bottom: 10px;" id="selectionTitle">SELECT YOUR CHARACTER</h2>
                <p id="selectionDesc" style="color: #aaa;">Choose your fighter</p>
            </div>
            <div class="characters-grid" id="charactersContainer"></div>
            <button onclick="confirmSelection()">CONTINUE</button>
            <button class="secondary" onclick="backToModes()">BACK</button>
        </div>

        <!-- Map Selection -->
        <div id="mapScreen">
            <h2 style="font-size: 2em; color: #ff0844; margin-bottom: 20px;">SELECT BATTLEFIELD</h2>
            <div class="maps-grid" id="mapsContainer"></div>
            <button onclick="startBattle()">START BATTLE</button>
            <button class="secondary" onclick="backToSelection()">BACK</button>
        </div>

        <!-- Game Screen -->
        <div id="gameScreen">
            <div id="domainOverlay"><div id="domainText">DOMAIN EXPANSION</div></div>
            <div id="comboDisplay" class="combo-display" style="display: none;"></div>

            <div class="hud">
                <div class="top-hud">
                    <div class="round-info" id="roundInfo">ROUND 1</div>
                    <div class="coins-display" id="coinsDisplay">üí∞ 0</div>
                </div>
                <div class="health-bars" id="healthBarsContainer">
                    <!-- Dynamic health bars will be inserted here -->
                </div>
                <div class="moves-bar" id="movesBar"></div>
            </div>
            <canvas id="gameCanvas" width="1200" height="600"></canvas>
            
            <div class="controls-footer">
                <span><b>WASD</b>: Move</span>
                <span><b>SPACE</b>: Dash</span>
                <span><b>J/K/U/I/O</b>: Attacks</span>
                <span><b>P</b>: Ultimate</span>
                <span id="p2controls" style="display:none;"><b>P2: Arrows + NUMPAD</b></span>
            </div>
        </div>

        <!-- Tournament Overlay -->
        <div id="tournamentOverlay">
            <h2>TOURNAMENT BRACKET</h2>
            <div class="tournament-bracket" id="tournamentBracket"></div>
            <button onclick="nextTournamentMatch()">NEXT MATCH</button>
        </div>

        <!-- Shop Screen -->
        <div id="shopScreen">
            <h2>CURSED ENERGY SHOP</h2>
            <div class="shop-items" id="shopItems"></div>
            <button onclick="closeShop()">NEXT BATTLE</button>
        </div>

        <!-- Game Over -->
        <div id="gameOver">
            <h2 id="gameOverTitle">EXORCISED</h2>
            <p id="gameOverText"></p>
            <button onclick="location.reload()">MAIN MENU</button>
        </div>
    </div>

<script>
    // --- CHARACTERS DATABASE ---
    const CHARACTERS = [
        { id: 'gojo', name: 'SATORU GOJO', title: 'The Strongest', icon: 'üëÅÔ∏è', color: '#00bfff', domainColor: '#0a0a2a', speed: 6.5, defense: 5, attack: 8, moves: { light: { name: 'Martial Arts', dmg: 8, cd: 0.3, type: 'melee', color: '#00bfff' }, heavy: { name: 'Infinity Strike', dmg: 20, cd: 1.5, type: 'melee', range: 100, color: '#0088ff' }, special1: { name: 'Cursed Blue', dmg: 35, cd: 4, type: 'projectile', color: '#0066ff', pull: true }, special2: { name: 'Reversal Red', dmg: 50, cd: 6, type: 'projectile', knockback: 150, color: '#ff0033' }, support: { name: 'Infinity', cd: 12, type: 'buff', shield: true, duration: 3, color: '#fff' }, ultimate: { name: 'UNLIMITED VOID', dmg: 20, type: 'domain', effect: 'stun', duration: 4, color: '#ffffff' } } },
        { id: 'sukuna', name: 'RYOMEN SUKUNA', title: 'King of Curses', icon: 'üëπ', color: '#ff0033', domainColor: '#2a0a0a', speed: 6, defense: 7, attack: 10, moves: { light: { name: 'Slash', dmg: 10, cd: 0.3, type: 'melee', color: '#ff0033' }, heavy: { name: 'Cleave', dmg: 28, cd: 1.5, type: 'melee', slash: true, color: '#cc0000' }, special1: { name: 'Dismantle', dmg: 40, cd: 5, type: 'projectile', multi: 3, color: '#990000' }, special2: { name: 'Divine Flame', dmg: 60, cd: 8, type: 'projectile', burn: true, color: '#ff6600' }, support: { name: 'Domain Amp', cd: 12, type: 'buff', damageBoost: 1.5, duration: 4, color: '#aa0000' }, ultimate: { name: 'MALEVOLENT SHRINE', dmg: 250, type: 'domain', effect: 'dot', color: '#660000' } } },
        { id: 'yuji', name: 'YUJI ITADORI', title: 'The Tiger', icon: 'ü•ä', color: '#ff6b00', speed: 7.5, defense: 6, attack: 7, moves: { light: { name: 'Quick Jab', dmg: 8, cd: 0.2, type: 'melee', color: '#ff6b00' }, heavy: { name: 'Divergent Fist', dmg: 22, cd: 1.2, type: 'melee', hits: 2, color: '#ff4400' }, special1: { name: 'Manji Kick', dmg: 35, cd: 4, type: 'melee', knockback: 120, color: '#ff8800' }, special2: { name: 'Black Flash', dmg: 70, cd: 8, type: 'melee', crit: true, color: '#000' }, support: { name: 'Focus', cd: 10, type: 'buff', speedBoost: 1.5, duration: 5, color: '#fff' }, ultimate: { name: 'RAGE MODE', dmg: 0, type: 'buff', damageBoost: 3, duration: 8, color: '#ff0000' } } },
        { id: 'megumi', name: 'MEGUMI FUSHIGURO', title: 'Ten Shadows', icon: 'üê∫', color: '#4a5568', domainColor: '#1a202c', speed: 6, defense: 5, attack: 6, moves: { light: { name: 'Strike', dmg: 7, cd: 0.3, type: 'melee', color: '#4a5568' }, heavy: { name: 'Shadow Hit', dmg: 18, cd: 1.5, type: 'melee', color: '#2d3748' }, special1: { name: 'Divine Dog', dmg: 30, cd: 6, type: 'summon', color: '#000' }, special2: { name: 'Nue', dmg: 40, cd: 7, type: 'projectile', stun: 1, color: '#ffd700' }, support: { name: 'Rabbit Escape', cd: 10, type: 'dodge', invuln: 2, color: '#fff' }, ultimate: { name: 'CHIMERA SHADOW GARDEN', dmg: 150, type: 'domain', effect: 'summon_swarm', color: '#1a202c' } } },
        { id: 'nobara', name: 'NOBARA KUGISAKI', title: 'Straw Doll', icon: 'üî®', color: '#ff69b4', speed: 5.5, defense: 4, attack: 7, moves: { light: { name: 'Nail', dmg: 9, cd: 0.3, type: 'melee', color: '#ff69b4' }, heavy: { name: 'Hammer', dmg: 24, cd: 1.5, type: 'melee', stun: 0.5, color: '#ff1493' }, special1: { name: 'Hairpin', dmg: 35, cd: 4, type: 'projectile', color: '#dc143c' }, special2: { name: 'Resonance', dmg: 50, cd: 7, type: 'delayed', delay: 1, color: '#c71585' }, support: { name: 'Straw Doll', cd: 9, type: 'buff', damageBoost: 1.3, duration: 5, color: '#ff1493' }, ultimate: { name: 'MAXIMUM OUTPUT', dmg: 140, type: 'beam', color: '#ff0066' } } },
        { id: 'yuta', name: 'YUTA OKKOTSU', title: 'Special Grade', icon: 'üíç', color: '#ffffff', domainColor: '#ffccff', speed: 6.5, defense: 6, attack: 8, moves: { light: { name: 'Katana Slash', dmg: 10, cd: 0.3, type: 'melee', color: '#eee' }, heavy: { name: 'Rika Strike', dmg: 30, cd: 2, type: 'melee', range: 120, color: '#4a004a' }, special1: { name: 'Cursed Speech: Die', dmg: 40, cd: 6, type: 'aoe', range: 200, color: '#purple' }, special2: { name: 'Love Blast', dmg: 60, cd: 8, type: 'beam', color: '#ff69b4' }, support: { name: 'Reverse Cursed', cd: 15, type: 'heal', amount: 40, color: '#00ff00' }, ultimate: { name: 'AUTHENTIC MUTUAL LOVE', dmg: 200, type: 'domain', effect: 'swords', color: '#ffb6c1' } } },
        { id: 'maki', name: 'MAKI ZENIN', title: 'Heavenly Restriction', icon: 'üëì', color: '#2e8b57', speed: 8.5, defense: 5, attack: 9, moves: { light: { name: 'Spear Jab', dmg: 12, cd: 0.2, type: 'melee', color: '#2e8b57' }, heavy: { name: 'Dragon Bone', dmg: 35, cd: 1.5, type: 'melee', knockback: 50, color: '#8b4513' }, special1: { name: 'Playful Cloud', dmg: 45, cd: 5, type: 'melee', hits: 3, color: '#ff0000' }, special2: { name: 'Rapid Slash', dmg: 20, cd: 4, type: 'teleport_attack', color: '#ccc' }, support: { name: 'Sense', cd: 8, type: 'dodge', invuln: 2.5, color: '#fff' }, ultimate: { name: 'SOUL SPLIT KATANA', dmg: 180, type: 'melee', range: 150, trueDamage: true, color: '#444' } } },
        { id: 'inumaki', name: 'TOGE INUMAKI', title: 'Cursed Speech', icon: 'üì¢', color: '#9370db', speed: 5.5, defense: 4, attack: 5, moves: { light: { name: 'Kick', dmg: 6, cd: 0.3, type: 'melee', color: '#9370db' }, heavy: { name: 'Explode', dmg: 25, cd: 2, type: 'aoe', range: 100, color: '#ffd700' }, special1: { name: 'Don\'t Move', dmg: 10, cd: 8, type: 'stun', duration: 2, color: '#000' }, special2: { name: 'Get Twisted', dmg: 50, cd: 7, type: 'projectile', color: '#800080' }, support: { name: 'Sleep', cd: 12, type: 'stun', duration: 1.5, color: '#aaa' }, ultimate: { name: 'BLAST AWAY', dmg: 150, type: 'beam', width: 200, color: '#fff' } } },
        { id: 'panda', name: 'PANDA', title: 'Cursed Corpse', icon: 'üêº', color: '#333', speed: 5, defense: 8, attack: 6, moves: { light: { name: 'Punch', dmg: 9, cd: 0.4, type: 'melee', color: '#fff' }, heavy: { name: 'Bear Hug', dmg: 25, cd: 1.8, type: 'melee', stun: 0.5, color: '#000' }, special1: { name: 'Gorilla Mode', dmg: 40, cd: 6, type: 'melee', knockback: 150, color: '#8b4513' }, special2: { name: 'Drumming Beat', dmg: 45, cd: 7, type: 'melee', color: '#a0522d' }, support: { name: 'Tank Up', cd: 10, type: 'buff', shield: true, duration: 4, color: '#333' }, ultimate: { name: 'TRICERATOPS MODE', dmg: 0, type: 'buff', damageBoost: 2, speedBoost: 1.5, duration: 8, color: '#2f4f4f' } } },
        { id: 'todo', name: 'AOI TODO', title: 'Boogie Woogie', icon: 'üëè', color: '#4169e1', speed: 6, defense: 6, attack: 7, moves: { light: { name: 'Jab', dmg: 9, cd: 0.3, type: 'melee', color: '#4169e1' }, heavy: { name: 'Stomp', dmg: 22, cd: 1.5, type: 'melee', color: '#000080' }, special1: { name: 'Boogie Woogie', dmg: 10, cd: 3, type: 'swap', color: '#ff69b4' }, special2: { name: 'Black Flash', dmg: 50, cd: 6, type: 'melee', crit: true, color: '#000' }, support: { name: 'Clap', cd: 5, type: 'swap', color: '#ff69b4' }, ultimate: { name: 'IQ 530,000', dmg: 120, type: 'teleport_blitz', hits: 10, color: '#4169e1' } } },
        { id: 'nanami', name: 'KENTO NANAMI', title: 'Ratio Technique', icon: 'üëî', color: '#f4a460', speed: 6, defense: 5, attack: 8, moves: { light: { name: 'Chop', dmg: 10, cd: 0.3, type: 'melee', color: '#f4a460' }, heavy: { name: 'Ratio', dmg: 35, cd: 2, type: 'melee', critChance: 0.5, color: '#000' }, special1: { name: 'Collapse', dmg: 40, cd: 5, type: 'aoe', range: 120, color: '#deb887' }, special2: { name: 'Tie Loosen', dmg: 0, cd: 8, type: 'buff', damageBoost: 1.5, duration: 4, color: '#ffd700' }, support: { name: 'Overtime', cd: 15, type: 'buff', damageBoost: 2, duration: 5, color: '#ff4500' }, ultimate: { name: 'RATIO COLLAPSE', dmg: 160, type: 'melee', crit: true, range: 200, color: '#daa520' } } },
        { id: 'mahito', name: 'MAHITO', title: 'Self-Embodiment', icon: 'üßµ', color: '#708090', domainColor: '#2f4f4f', speed: 6.5, defense: 5, attack: 7, moves: { light: { name: 'Touch', dmg: 8, cd: 0.3, type: 'melee', color: '#708090' }, heavy: { name: 'Blade Arm', dmg: 24, cd: 1.5, type: 'melee', range: 100, color: '#c0c0c0' }, special1: { name: 'Soul Multiplicity', dmg: 30, cd: 4, type: 'projectile', multi: 2, color: '#483d8b' }, special2: { name: 'Body Repel', dmg: 40, cd: 6, type: 'aoe', knockback: 200, color: '#778899' }, support: { name: 'Shape Shift', cd: 8, type: 'dodge', invuln: 2, color: '#fff' }, ultimate: { name: 'SELF-EMBODIMENT OF PERFECTION', dmg: 200, type: 'domain', effect: 'instant_dmg', color: '#000000' } } },
        { id: 'jogo', name: 'JOGO', title: 'Disaster Flame', icon: 'üåã', color: '#8b0000', domainColor: '#4a0404', speed: 7, defense: 4, attack: 9, moves: { light: { name: 'Ember', dmg: 10, cd: 0.3, type: 'projectile', color: '#ff4500' }, heavy: { name: 'Lava Burst', dmg: 28, cd: 1.8, type: 'aoe', range: 100, color: '#8b0000' }, special1: { name: 'Ember Insects', dmg: 35, cd: 5, type: 'projectile', multi: 3, homing: true, color: '#ff8c00' }, special2: { name: 'Maximum Meteor', dmg: 70, cd: 10, type: 'aoe', delay: 1.5, range: 200, color: '#ffd700' }, support: { name: 'Heat Wave', cd: 12, type: 'buff', damageBoost: 1.4, duration: 5, color: '#ff4500' }, ultimate: { name: 'COFFIN OF THE IRON MOUNTAIN', dmg: 180, type: 'domain', effect: 'burn_dot', color: '#800000' } } },
        { id: 'toji', name: 'TOJI FUSHIGURO', title: 'Sorcerer Killer', icon: '‚õìÔ∏è', color: '#111', speed: 9, defense: 6, attack: 10, moves: { light: { name: 'Kick', dmg: 12, cd: 0.2, type: 'melee', color: '#333' }, heavy: { name: 'Split Soul', dmg: 30, cd: 1.5, type: 'melee', trueDamage: true, color: '#555' }, special1: { name: 'Inverted Spear', dmg: 40, cd: 5, type: 'melee', dispel: true, color: '#fff' }, special2: { name: 'Chain of Thousand', dmg: 35, cd: 6, type: 'melee', range: 300, color: '#888' }, support: { name: 'Invisible', cd: 10, type: 'dodge', invuln: 3, color: '#000' }, ultimate: { name: 'HEAVENLY RESTRICTION', dmg: 0, type: 'buff', speedBoost: 2, damageBoost: 2, duration: 10, color: '#1a1a1a' } } },
        
        // NEW CHARACTERS (30 MORE)
        { id: 'geto', name: 'SUGURU GETO', title: 'Curse Manipulator', icon: 'üåÄ', color: '#4b0082', domainColor: '#1a0033', speed: 6, defense: 6, attack: 7, moves: { light: { name: 'Spirit Strike', dmg: 8, cd: 0.3, type: 'melee', color: '#4b0082' }, heavy: { name: 'Curse Release', dmg: 22, cd: 1.5, type: 'projectile', multi: 2, color: '#8b00ff' }, special1: { name: 'Cursed Spirit: Ryuzu', dmg: 38, cd: 5, type: 'summon', color: '#9400d3' }, special2: { name: 'Maximum Uzumaki', dmg: 65, cd: 8, type: 'beam', color: '#4b0082' }, support: { name: 'Absorb Curse', cd: 10, type: 'heal', amount: 30, color: '#8a2be2' }, ultimate: { name: 'CURSED SPIRIT MANIPULATION', dmg: 180, type: 'domain', effect: 'summon_swarm', color: '#2e0854' } } },
        { id: 'hakari', name: 'KINJI HAKARI', title: 'Fever Gambler', icon: 'üé∞', color: '#ffd700', speed: 7, defense: 5, attack: 8, moves: { light: { name: 'Rush Punch', dmg: 9, cd: 0.3, type: 'melee', color: '#ffd700' }, heavy: { name: 'Jackpot Strike', dmg: 26, cd: 1.5, type: 'melee', color: '#ffaa00' }, special1: { name: 'Rough Energy', dmg: 35, cd: 4, type: 'projectile', color: '#ff8c00' }, special2: { name: 'Probability Roll', dmg: 45, cd: 6, type: 'aoe', range: 120, color: '#daa520' }, support: { name: 'Lucky Streak', cd: 12, type: 'buff', damageBoost: 1.6, duration: 4, color: '#ffd700' }, ultimate: { name: 'IDLE DEATH GAMBLE', dmg: 0, type: 'buff', damageBoost: 2.5, speedBoost: 2, duration: 10, color: '#ffff00' } } },
        { id: 'kashimo', name: 'HAJIME KASHIMO', title: 'Lightning God', icon: '‚ö°', color: '#00ffff', speed: 7.5, defense: 5, attack: 9, moves: { light: { name: 'Electric Jab', dmg: 10, cd: 0.25, type: 'melee', color: '#00ffff' }, heavy: { name: 'Lightning Strike', dmg: 30, cd: 1.5, type: 'projectile', stun: 0.5, color: '#00bfff' }, special1: { name: 'Thunderclap', dmg: 42, cd: 5, type: 'aoe', range: 150, color: '#1e90ff' }, special2: { name: 'Bolt Rush', dmg: 38, cd: 4, type: 'teleport_attack', color: '#87ceeb' }, support: { name: 'Static Field', cd: 10, type: 'buff', speedBoost: 1.7, duration: 5, color: '#add8e6' }, ultimate: { name: 'MYTHICAL BEAST AMBER', dmg: 200, type: 'melee', crit: true, range: 200, color: '#00ffff' } } },
        { id: 'higuruma', name: 'HIROMI HIGURUMA', title: 'Judgeman', icon: '‚öñÔ∏è', color: '#8b4513', speed: 5.5, defense: 6, attack: 7, moves: { light: { name: 'Gavel Strike', dmg: 8, cd: 0.35, type: 'melee', color: '#8b4513' }, heavy: { name: 'Executioner Sword', dmg: 32, cd: 2, type: 'melee', range: 120, trueDamage: true, color: '#654321' }, special1: { name: 'Confiscation', dmg: 20, cd: 8, type: 'stun', duration: 1.5, color: '#a0522d' }, special2: { name: 'Death Penalty', dmg: 80, cd: 10, type: 'melee', trueDamage: true, color: '#000' }, support: { name: 'Court Session', cd: 15, type: 'buff', damageBoost: 1.5, duration: 5, color: '#d2691e' }, ultimate: { name: 'DEADLY SENTENCING', dmg: 250, type: 'domain', effect: 'instant_dmg', color: '#4a2511' } } },
        { id: 'takaba', name: 'FUMIHIKO TAKABA', title: 'Comedian', icon: 'üé≠', color: '#ff1493', speed: 6, defense: 4, attack: 6, moves: { light: { name: 'Slapstick', dmg: 7, cd: 0.3, type: 'melee', color: '#ff1493' }, heavy: { name: 'Punchline', dmg: 20, cd: 1.5, type: 'melee', knockback: 100, color: '#ff69b4' }, special1: { name: 'Comedy Gold', dmg: 30, cd: 4, type: 'projectile', multi: 3, color: '#ff00ff' }, special2: { name: 'Stand-up Rush', dmg: 40, cd: 6, type: 'aoe', range: 150, color: '#db7093' }, support: { name: 'Laugh Track', cd: 10, type: 'dodge', invuln: 2, color: '#ffc0cb' }, ultimate: { name: 'REALITY BENDING JOKE', dmg: 150, type: 'domain', effect: 'stun', color: '#ff1493' } } },
        { id: 'uro', name: 'TAKAKO URO', title: 'Sky Manipulator', icon: '‚òÅÔ∏è', color: '#87ceeb', speed: 7, defense: 5, attack: 7, moves: { light: { name: 'Sky Palm', dmg: 8, cd: 0.3, type: 'melee', color: '#87ceeb' }, heavy: { name: 'Thin Ice Breaker', dmg: 26, cd: 1.8, type: 'melee', range: 100, color: '#4682b4' }, special1: { name: 'Sky Rip', dmg: 35, cd: 5, type: 'projectile', color: '#6495ed' }, special2: { name: 'Deflection', dmg: 15, cd: 4, type: 'buff', shield: true, duration: 3, color: '#b0e0e6' }, support: { name: 'Coated Sky', cd: 10, type: 'dodge', invuln: 2, color: '#add8e6' }, ultimate: { name: 'SKY DOMAIN', dmg: 140, type: 'beam', color: '#4169e1' } } },
        { id: 'ryu', name: 'RYU ISHIGORI', title: 'Granite Blast', icon: 'üí•', color: '#ff4500', speed: 6, defense: 7, attack: 9, moves: { light: { name: 'Energy Punch', dmg: 10, cd: 0.3, type: 'melee', color: '#ff4500' }, heavy: { name: 'Cursed Blast', dmg: 28, cd: 1.5, type: 'projectile', color: '#ff6347' }, special1: { name: 'Granite Blast', dmg: 55, cd: 6, type: 'beam', color: '#ff0000' }, special2: { name: 'Maximum Output', dmg: 48, cd: 7, type: 'aoe', range: 150, color: '#dc143c' }, support: { name: 'Energy Surge', cd: 12, type: 'buff', damageBoost: 1.6, duration: 5, color: '#ff1493' }, ultimate: { name: 'FULL ENERGY RELEASE', dmg: 190, type: 'beam', color: '#8b0000' } } },
        { id: 'uraume', name: 'URAUME', title: 'Ice Formation', icon: '‚ùÑÔ∏è', color: '#b0e0e6', speed: 6, defense: 6, attack: 7, moves: { light: { name: 'Ice Needle', dmg: 8, cd: 0.3, type: 'projectile', color: '#b0e0e6' }, heavy: { name: 'Frost Calm', dmg: 24, cd: 1.5, type: 'aoe', range: 100, color: '#add8e6' }, special1: { name: 'Ice Formation', dmg: 36, cd: 5, type: 'projectile', multi: 3, color: '#87ceeb' }, special2: { name: 'Frozen Star', dmg: 50, cd: 7, type: 'aoe', stun: 1, range: 150, color: '#4682b4' }, support: { name: 'Ice Wall', cd: 10, type: 'buff', shield: true, duration: 4, color: '#e0ffff' }, ultimate: { name: 'ABSOLUTE ZERO', dmg: 160, type: 'domain', effect: 'stun', color: '#00bfff' } } },
        { id: 'choso', name: 'CHOSO', title: 'Blood Manipulation', icon: 'ü©∏', color: '#8b0000', speed: 6.5, defense: 6, attack: 8, moves: { light: { name: 'Blood Edge', dmg: 9, cd: 0.3, type: 'melee', color: '#8b0000' }, heavy: { name: 'Slicing Exorcism', dmg: 26, cd: 1.5, type: 'projectile', color: '#a52a2a' }, special1: { name: 'Piercing Blood', dmg: 45, cd: 5, type: 'beam', color: '#dc143c' }, special2: { name: 'Supernova', dmg: 52, cd: 7, type: 'aoe', range: 120, color: '#b22222' }, support: { name: 'Blood Armor', cd: 10, type: 'buff', shield: true, duration: 4, color: '#8b0000' }, ultimate: { name: 'CONVERGENCE', dmg: 170, type: 'beam', color: '#800000' } } },
        { id: 'hanami', name: 'HANAMI', title: 'Disaster Plants', icon: 'üå≥', color: '#228b22', domainColor: '#013220', speed: 5, defense: 9, attack: 7, moves: { light: { name: 'Branch Strike', dmg: 8, cd: 0.35, type: 'melee', color: '#228b22' }, heavy: { name: 'Wooden Ball', dmg: 24, cd: 1.8, type: 'projectile', color: '#2e8b57' }, special1: { name: 'Cursed Buds', dmg: 32, cd: 5, type: 'projectile', multi: 4, color: '#3cb371' }, special2: { name: 'Forest Roots', dmg: 40, cd: 6, type: 'aoe', range: 150, color: '#006400' }, support: { name: 'Nature Shield', cd: 12, type: 'buff', shield: true, duration: 5, color: '#90ee90' }, ultimate: { name: 'FLOWERING DOMAIN', dmg: 150, type: 'domain', effect: 'dot', color: '#0f5a32' } } },
        { id: 'dagon', name: 'DAGON', title: 'Disaster Tides', icon: 'üåä', color: '#1e90ff', domainColor: '#000080', speed: 6, defense: 7, attack: 7, moves: { light: { name: 'Water Strike', dmg: 8, cd: 0.3, type: 'melee', color: '#1e90ff' }, heavy: { name: 'Tidal Wave', dmg: 25, cd: 1.8, type: 'projectile', knockback: 120, color: '#4169e1' }, special1: { name: 'Shikigami Swarm', dmg: 30, cd: 5, type: 'summon', color: '#00bfff' }, special2: { name: 'Death Swarm', dmg: 44, cd: 6, type: 'aoe', range: 150, color: '#6495ed' }, support: { name: 'Water Barrier', cd: 10, type: 'buff', shield: true, duration: 4, color: '#87ceeb' }, ultimate: { name: 'HORIZON OF THE CAPTIVATING SKANDHA', dmg: 160, type: 'domain', effect: 'summon_swarm', color: '#00008b' } } },
        { id: 'naoya', name: 'NAOYA ZENIN', title: 'Projection Sorcery', icon: 'üí®', color: '#fff44f', speed: 9, defense: 4, attack: 7, moves: { light: { name: '24 FPS Strike', dmg: 9, cd: 0.2, type: 'melee', color: '#fff44f' }, heavy: { name: 'Acceleration', dmg: 22, cd: 1.2, type: 'teleport_attack', color: '#ffeb3b' }, special1: { name: 'Projection Blitz', dmg: 35, cd: 4, type: 'melee', hits: 3, color: '#ffd700' }, special2: { name: 'Mach Speed', dmg: 40, cd: 5, type: 'teleport_attack', color: '#ffff00' }, support: { name: 'Frame Perfect', cd: 8, type: 'buff', speedBoost: 2, duration: 4, color: '#ffffe0' }, ultimate: { name: 'TIME CELL MOON PALACE', dmg: 140, type: 'domain', effect: 'stun', color: '#f0e68c' } } },
        { id: 'mei', name: 'MEI MEI', title: 'Blackbird', icon: 'üê¶', color: '#708090', speed: 7, defense: 5, attack: 8, moves: { light: { name: 'Axe Chop', dmg: 10, cd: 0.3, type: 'melee', color: '#708090' }, heavy: { name: 'Black Bird Strike', dmg: 28, cd: 1.5, type: 'projectile', color: '#2f4f4f' }, special1: { name: 'Bird Strike', dmg: 40, cd: 5, type: 'projectile', multi: 3, color: '#696969' }, special2: { name: 'Kamikaze Crows', dmg: 60, cd: 8, type: 'aoe', range: 200, color: '#000' }, support: { name: 'Surveillance', cd: 10, type: 'dodge', invuln: 2, color: '#a9a9a9' }, ultimate: { name: 'MAXIMUM BLACK BIRD', dmg: 150, type: 'projectile', multi: 10, color: '#000000' } } },
        { id: 'kusakabe', name: 'ATSUYA KUSAKABE', title: 'Simple Domain', icon: '‚öîÔ∏è', color: '#4a4a4a', speed: 6.5, defense: 7, attack: 7, moves: { light: { name: 'Katana Slash', dmg: 9, cd: 0.3, type: 'melee', color: '#4a4a4a' }, heavy: { name: 'Evening Moon Sword', dmg: 26, cd: 1.5, type: 'melee', range: 100, color: '#696969' }, special1: { name: 'Batto Sword Drawing', dmg: 40, cd: 5, type: 'melee', crit: true, color: '#808080' }, special2: { name: 'Hazy Moon', dmg: 35, cd: 6, type: 'slash', color: '#a9a9a9' }, support: { name: 'Simple Domain', cd: 12, type: 'buff', shield: true, duration: 3, color: '#d3d3d3' }, ultimate: { name: 'SIMPLE DOMAIN: MAXIMUM', dmg: 130, type: 'domain', effect: 'stun', color: '#2f4f4f' } } },
        { id: 'miguel', name: 'MIGUEL', title: 'Black Rope', icon: 'ü™¢', color: '#8b4513', speed: 7, defense: 6, attack: 8, moves: { light: { name: 'Rope Whip', dmg: 9, cd: 0.3, type: 'melee', range: 100, color: '#8b4513' }, heavy: { name: 'Binding Strike', dmg: 24, cd: 1.5, type: 'melee', stun: 0.5, color: '#a0522d' }, special1: { name: 'Black Rope Lash', dmg: 38, cd: 5, type: 'melee', dispel: true, color: '#654321' }, special2: { name: 'Cursed Tool Mastery', dmg: 42, cd: 6, type: 'melee', hits: 2, color: '#d2691e' }, support: { name: 'Rope Defense', cd: 10, type: 'buff', shield: true, duration: 3, color: '#deb887' }, ultimate: { name: 'BLACK ROPE PRISON', dmg: 140, type: 'melee', range: 150, color: '#4a2511' } } },
        { id: 'larue', name: 'LARUE', title: 'Heart Catcher', icon: 'üíî', color: '#ff0066', speed: 5.5, defense: 5, attack: 6, moves: { light: { name: 'Heart Strike', dmg: 7, cd: 0.3, type: 'melee', color: '#ff0066' }, heavy: { name: 'Love Beam', dmg: 22, cd: 1.5, type: 'projectile', color: '#ff1493' }, special1: { name: 'Heart Snatch', dmg: 35, cd: 6, type: 'melee', stun: 1, color: '#c71585' }, special2: { name: 'Affection Blast', dmg: 40, cd: 7, type: 'aoe', range: 120, color: '#ff69b4' }, support: { name: 'Heartfelt Defense', cd: 10, type: 'buff', shield: true, duration: 3, color: '#ffb6c1' }, ultimate: { name: 'HEART CHAMBER', dmg: 130, type: 'domain', effect: 'stun', color: '#db7093' } } },
        { id: 'rika', name: 'RIKA ORIMOTO', title: 'Queen of Curses', icon: 'üëª', color: '#800080', speed: 6, defense: 8, attack: 10, moves: { light: { name: 'Claw Swipe', dmg: 12, cd: 0.3, type: 'melee', color: '#800080' }, heavy: { name: 'Cursed Bite', dmg: 32, cd: 1.5, type: 'melee', range: 100, color: '#9932cc' }, special1: { name: 'Rage Blast', dmg: 50, cd: 5, type: 'beam', color: '#9400d3' }, special2: { name: 'Love Fury', dmg: 45, cd: 6, type: 'aoe', range: 150, color: '#8b008b' }, support: { name: 'Protective Love', cd: 10, type: 'buff', shield: true, duration: 4, color: '#da70d6' }, ultimate: { name: 'QUEEN\'S WRATH', dmg: 200, type: 'melee', range: 200, color: '#4b0082' } } },
        { id: 'kenjaku', name: 'KENJAKU', title: 'Brain Parasite', icon: 'üß†', color: '#4a0e4e', domainColor: '#1a0033', speed: 6, defense: 7, attack: 8, moves: { light: { name: 'Cursed Strike', dmg: 9, cd: 0.3, type: 'melee', color: '#4a0e4e' }, heavy: { name: 'Anti-Gravity', dmg: 26, cd: 1.8, type: 'aoe', range: 100, color: '#6a0dad' }, special1: { name: 'Cursed Spirit Summon', dmg: 38, cd: 5, type: 'summon', color: '#8b008b' }, special2: { name: 'Maximum Uzumaki', dmg: 58, cd: 8, type: 'beam', color: '#9400d3' }, support: { name: 'Body Hop', cd: 10, type: 'heal', amount: 35, color: '#ba55d3' }, ultimate: { name: 'WOMB PROFUSION', dmg: 180, type: 'domain', effect: 'dot', color: '#2e0033' } } },
        { id: 'yorozu', name: 'YOROZU', title: 'Construction', icon: 'üîß', color: '#ff6347', speed: 6, defense: 6, attack: 8, moves: { light: { name: 'Tool Strike', dmg: 9, cd: 0.3, type: 'melee', color: '#ff6347' }, heavy: { name: 'Construct Blade', dmg: 26, cd: 1.5, type: 'melee', range: 100, color: '#ff4500' }, special1: { name: 'Liquid Metal', dmg: 40, cd: 5, type: 'projectile', multi: 3, color: '#ff8c00' }, special2: { name: 'Perfect Sphere', dmg: 70, cd: 10, type: 'projectile', color: '#ffa500' }, support: { name: 'Construct Armor', cd: 12, type: 'buff', shield: true, duration: 4, color: '#ffd700' }, ultimate: { name: 'THREE-FOLD AFFLICTION', dmg: 190, type: 'domain', effect: 'instant_dmg', color: '#ff0000' } } },
        { id: 'angel', name: 'ANGEL / HANA', title: 'Extinguish', icon: 'üëº', color: '#ffffff', speed: 6, defense: 5, attack: 7, moves: { light: { name: 'Holy Strike', dmg: 8, cd: 0.3, type: 'melee', color: '#ffffff' }, heavy: { name: 'Divine Beam', dmg: 24, cd: 1.5, type: 'projectile', color: '#fffacd' }, special1: { name: 'Extinguish', dmg: 40, cd: 6, type: 'aoe', dispel: true, range: 150, color: '#ffffe0' }, special2: { name: 'Jacob\'s Ladder', dmg: 60, cd: 8, type: 'beam', color: '#fff68f' }, support: { name: 'Holy Aura', cd: 10, type: 'buff', shield: true, duration: 3, color: '#fffff0' }, ultimate: { name: 'DIVINE JUDGMENT', dmg: 160, type: 'beam', trueDamage: true, color: '#f0f8ff' } } },
        { id: 'reggie', name: 'REGGIE STAR', title: 'Contractual Re-Creation', icon: 'üìú', color: '#daa520', speed: 6, defense: 6, attack: 7, moves: { light: { name: 'Receipt Strike', dmg: 8, cd: 0.3, type: 'melee', color: '#daa520' }, heavy: { name: 'Car Slam', dmg: 28, cd: 2, type: 'aoe', range: 80, color: '#b8860b' }, special1: { name: 'Weapon Summon', dmg: 36, cd: 5, type: 'projectile', multi: 2, color: '#ffd700' }, special2: { name: 'Receipt Rain', dmg: 42, cd: 6, type: 'aoe', range: 150, color: '#ffdf00' }, support: { name: 'Contract Shield', cd: 10, type: 'buff', shield: true, duration: 3, color: '#fff8dc' }, ultimate: { name: 'MAXIMUM RECEIPTS', dmg: 140, type: 'aoe', range: 300, color: '#f0e68c' } } },
        { id: 'dhruv', name: 'DHRUV LAKDAWALLA', title: 'Shikigami Master', icon: 'ü¶Ö', color: '#8fbc8f', speed: 5.5, defense: 5, attack: 7, moves: { light: { name: 'Summon Strike', dmg: 7, cd: 0.3, type: 'melee', color: '#8fbc8f' }, heavy: { name: 'Shikigami Attack', dmg: 24, cd: 1.5, type: 'projectile', color: '#2e8b57' }, special1: { name: 'Multiple Summons', dmg: 32, cd: 5, type: 'summon', color: '#3cb371' }, special2: { name: 'Shikigami Swarm', dmg: 40, cd: 6, type: 'aoe', range: 150, color: '#228b22' }, support: { name: 'Summon Defense', cd: 10, type: 'buff', shield: true, duration: 3, color: '#90ee90' }, ultimate: { name: 'SHIKIGAMI DOMAIN', dmg: 150, type: 'domain', effect: 'summon_swarm', color: '#006400' } } },
        { id: 'kurourushi', name: 'KUROURUSHI', title: 'Cockroach Curse', icon: 'ü™≥', color: '#2f4f2f', speed: 7, defense: 7, attack: 6, moves: { light: { name: 'Swarm Bite', dmg: 8, cd: 0.25, type: 'melee', color: '#2f4f2f' }, heavy: { name: 'Roach Burst', dmg: 22, cd: 1.5, type: 'aoe', range: 100, color: '#3d3d3d' }, special1: { name: 'Festering Life', dmg: 30, cd: 5, type: 'projectile', multi: 4, color: '#4a4a4a' }, special2: { name: 'Roach Swarm', dmg: 38, cd: 6, type: 'aoe', range: 150, color: '#696969' }, support: { name: 'Carapace', cd: 10, type: 'buff', shield: true, duration: 4, color: '#556b2f' }, ultimate: { name: 'INFESTATION DOMAIN', dmg: 140, type: 'domain', effect: 'dot', color: '#1a1a1a' } } },
        { id: 'hajime', name: 'HAJIME', title: 'Kitchen Knife', icon: 'üî™', color: '#c0c0c0', speed: 7, defense: 5, attack: 7, moves: { light: { name: 'Quick Slice', dmg: 9, cd: 0.25, type: 'melee', color: '#c0c0c0' }, heavy: { name: 'Deep Cut', dmg: 24, cd: 1.3, type: 'melee', color: '#a9a9a9' }, special1: { name: 'Blade Dance', dmg: 36, cd: 4, type: 'melee', hits: 3, color: '#808080' }, special2: { name: 'Knife Storm', dmg: 40, cd: 5, type: 'projectile', multi: 5, color: '#696969' }, support: { name: 'Shadow Step', cd: 8, type: 'dodge', invuln: 2, color: '#dcdcdc' }, ultimate: { name: 'SURGICAL PRECISION', dmg: 130, type: 'melee', trueDamage: true, range: 150, color: '#2f4f4f' } } },
        { id: 'ichiji', name: 'KIYOTAKA ICHIJI', title: 'Manager', icon: 'üöó', color: '#4169e1', speed: 4, defense: 8, attack: 4, moves: { light: { name: 'Panic Strike', dmg: 5, cd: 0.4, type: 'melee', color: '#4169e1' }, heavy: { name: 'Briefcase Slam', dmg: 15, cd: 2, type: 'melee', color: '#0000cd' }, special1: { name: 'Support Call', dmg: 25, cd: 8, type: 'summon', color: '#1e90ff' }, special2: { name: 'Barrier Technique', dmg: 20, cd: 6, type: 'buff', shield: true, duration: 3, color: '#00bfff' }, support: { name: 'Emergency Exit', cd: 10, type: 'dodge', invuln: 3, color: '#87ceeb' }, ultimate: { name: 'BACKUP ARRIVAL', dmg: 100, type: 'summon', color: '#4682b4' } } },
        { id: 'mimiko', name: 'MIMIKO & NANAKO', title: 'Twin Dolls', icon: 'üë≠', color: '#ff00ff', speed: 6, defense: 5, attack: 6, moves: { light: { name: 'Tag Team', dmg: 8, cd: 0.3, type: 'melee', color: '#ff00ff' }, heavy: { name: 'Dual Strike', dmg: 22, cd: 1.5, type: 'melee', hits: 2, color: '#ee82ee' }, special1: { name: 'Phone Curse', dmg: 35, cd: 5, type: 'projectile', stun: 0.5, color: '#da70d6' }, special2: { name: 'Doll Curse', dmg: 40, cd: 6, type: 'aoe', range: 120, color: '#ba55d3' }, support: { name: 'Twin Bond', cd: 10, type: 'buff', damageBoost: 1.4, duration: 4, color: '#dda0dd' }, ultimate: { name: 'SYNCHRONIZED ASSAULT', dmg: 130, type: 'teleport_blitz', hits: 8, color: '#9370db' } } },
        { id: 'awasaka', name: 'KOKICHI MUTA (MECHAMARU)', title: 'Ultimate Mechamaru', icon: 'ü§ñ', color: '#708090', speed: 5, defense: 9, attack: 8, moves: { light: { name: 'Cannon Punch', dmg: 10, cd: 0.3, type: 'melee', color: '#708090' }, heavy: { name: 'Ultra Cannon', dmg: 30, cd: 2, type: 'projectile', color: '#696969' }, special1: { name: 'Missile Barrage', dmg: 42, cd: 5, type: 'projectile', multi: 4, color: '#808080' }, special2: { name: 'Sword Option', dmg: 38, cd: 4, type: 'melee', range: 150, color: '#a9a9a9' }, support: { name: 'Energy Shield', cd: 10, type: 'buff', shield: true, duration: 5, color: '#c0c0c0' }, ultimate: { name: 'ULTIMATE MECHAMARU MODE', dmg: 0, type: 'buff', damageBoost: 2.5, duration: 8, color: '#2f4f4f' } } },
        { id: 'junpei', name: 'JUNPEI YOSHINO', title: 'Moon Dregs', icon: 'üåô', color: '#9370db', speed: 5.5, defense: 4, attack: 6, moves: { light: { name: 'Jellyfish Slap', dmg: 7, cd: 0.3, type: 'melee', color: '#9370db' }, heavy: { name: 'Moon Dregs Slam', dmg: 22, cd: 1.5, type: 'melee', range: 100, color: '#8a2be2' }, special1: { name: 'Jellyfish Swarm', dmg: 32, cd: 5, type: 'projectile', multi: 3, color: '#9932cc' }, special2: { name: 'Poison Touch', dmg: 28, cd: 6, type: 'melee', stun: 1, color: '#8b008b' }, support: { name: 'Shikigami Shield', cd: 10, type: 'buff', shield: true, duration: 3, color: '#ba55d3' }, ultimate: { name: 'MOON DREGS DOMAIN', dmg: 120, type: 'domain', effect: 'dot', color: '#4b0082' } } },
        { id: 'amai', name: 'AMAI MASK', title: 'Comedian Clone', icon: 'üòÑ', color: '#ffa500', speed: 6, defense: 5, attack: 6, moves: { light: { name: 'Joke Punch', dmg: 7, cd: 0.3, type: 'melee', color: '#ffa500' }, heavy: { name: 'Comedy Kick', dmg: 20, cd: 1.5, type: 'melee', color: '#ff8c00' }, special1: { name: 'Laugh Attack', dmg: 30, cd: 5, type: 'aoe', range: 120, color: '#ff7f50' }, special2: { name: 'Punchline Barrage', dmg: 35, cd: 6, type: 'projectile', multi: 3, color: '#ff6347' }, support: { name: 'Comedy Shield', cd: 10, type: 'buff', shield: true, duration: 3, color: '#ffd700' }, ultimate: { name: 'FINAL JOKE', dmg: 110, type: 'aoe', range: 200, color: '#ff4500' } } },
        { id: 'noritoshi', name: 'NORITOSHI KAMO', title: 'Blood Bow', icon: 'üèπ', color: '#dc143c', speed: 6, defense: 5, attack: 7, moves: { light: { name: 'Blood Arrow', dmg: 9, cd: 0.3, type: 'projectile', color: '#dc143c' }, heavy: { name: 'Crimson Binding', dmg: 24, cd: 1.5, type: 'projectile', stun: 0.5, color: '#b22222' }, special1: { name: 'Piercing Blood', dmg: 38, cd: 5, type: 'beam', color: '#8b0000' }, special2: { name: 'Blood Edge', dmg: 35, cd: 6, type: 'melee', range: 120, color: '#a52a2a' }, support: { name: 'Blood Shield', cd: 10, type: 'buff', shield: true, duration: 3, color: '#cd5c5c' }, ultimate: { name: 'BLOOD METEOR', dmg: 140, type: 'aoe', range: 200, color: '#8b0000' } } },
        { id: 'mai', name: 'MAI ZENIN', title: 'Construction', icon: 'üî´', color: '#4682b4', speed: 6, defense: 4, attack: 7, moves: { light: { name: 'Quick Shot', dmg: 9, cd: 0.25, type: 'projectile', color: '#4682b4' }, heavy: { name: 'Sniper Shot', dmg: 32, cd: 2, type: 'projectile', crit: true, color: '#4169e1' }, special1: { name: 'Bullet Storm', dmg: 36, cd: 4, type: 'projectile', multi: 5, color: '#1e90ff' }, special2: { name: 'Construct Weapon', dmg: 40, cd: 5, type: 'melee', color: '#00bfff' }, support: { name: 'Take Cover', cd: 10, type: 'dodge', invuln: 2, color: '#87ceeb' }, ultimate: { name: 'ULTIMATE CONSTRUCTION', dmg: 130, type: 'projectile', multi: 10, color: '#4682b4' } } }
    ];

    const MAPS = [
        { id: 'shibuya', name: 'Shibuya Station', icon: 'üèôÔ∏è', bgColor: '#1a0a0a', floorColor: '#2a1a1a' },
        { id: 'school', name: 'Jujutsu High', icon: 'üè´', bgColor: '#0a1a0a', floorColor: '#1a2a1a' },
        { id: 'forest', name: 'Cursed Forest', icon: 'üå≤', bgColor: '#0a0a1a', floorColor: '#1a1a2a' },
        { id: 'void', name: 'Infinite Void', icon: 'üåå', bgColor: '#000033', floorColor: '#000055' },
        { id: 'shrine', name: 'Malevolent Shrine', icon: '‚õ©Ô∏è', bgColor: '#2a0a0a', floorColor: '#3a1a1a' },
        { id: 'beach', name: 'Cursed Beach', icon: 'üèñÔ∏è', bgColor: '#0a1a2a', floorColor: '#1a2a3a' }
    ];

    const SHOP_ITEMS = [
        { id: 'health', name: 'Health Boost', icon: '‚ù§Ô∏è', price: 50, effect: 'maxHealth', value: 25 },
        { id: 'damage', name: 'Power Up', icon: '‚öîÔ∏è', price: 75, effect: 'damageMultiplier', value: 0.15 },
        { id: 'speed', name: 'Speed Up', icon: '‚ö°', price: 60, effect: 'speedBoost', value: 1.2 },
        { id: 'cooldown', name: 'Rapid Tech', icon: '‚è±Ô∏è', price: 100, effect: 'cooldownReduction', value: 0.1 },
        { id: 'lifesteal', name: 'Cursed Drain', icon: 'ü©∏', price: 120, effect: 'lifesteal', value: 0.08 },
        { id: 'defense', name: 'Iron Body', icon: 'üõ°Ô∏è', price: 90, effect: 'damageReduction', value: 0.1 }
    ];

    // --- GAME VARIABLES ---
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    const bgCanvas = document.getElementById('bgCanvas');
    
    let gameMode = null;
    let gameActive = false;
    let selectedChars = [];
    let selectedMap = null;
    let fighters = [];
    let projectiles = [];
    let effects = [];
    let particles = [];
    let supports = [];
    let keys = {};
    
    let currentRound = 1;
    let coins = 0;
    let comboCount = 0;
    let lastHitTime = 0;
    let domainActive = false;
    
    // Tournament mode
    let tournamentBracket = [];
    let currentTournamentMatch = 0;
    
    let playerStats = {
        maxHealth: 100,
        damageMultiplier: 1,
        speedBoost: 0,
        cooldownReduction: 0,
        lifesteal: 0,
        damageReduction: 0
    };

    // --- CLASSES ---
    class Fighter {
        constructor(x, y, charData, isPlayer, playerNumber = 1) {
            this.x = x;
            this.y = y;
            this.width = 50;
            this.height = 80;
            this.char = charData;
            this.isPlayer = isPlayer;
            this.playerNumber = playerNumber;
            
            this.maxHealth = isPlayer ? (100 + playerStats.maxHealth) : (100 + (currentRound * 15));
            if (!isPlayer && currentRound % 5 === 0) this.maxHealth *= 1.5;
            this.health = this.maxHealth;
            this.speed = charData.speed + (isPlayer ? playerStats.speedBoost : 0);
            
            this.vx = 0;
            this.vy = 0;
            this.facing = isPlayer ? 1 : -1;
            this.onGround = true;
            this.jumpPower = 0;
            this.dashCooldown = 0;
            
            this.cooldowns = { light: 0, heavy: 0, special1: 0, special2: 0, support: 0, ultimate: 0 };
            this.buffs = {};
            this.stunned = 0;
            this.invuln = 0;
            this.ultimateCharge = 0;
            
            this.combo = 0;
            this.lastAttackTime = 0;
        }

        update() {
            if (this.stunned > 0) {
                this.stunned--;
                return;
            }

            if (this.invuln > 0) this.invuln--;
            if (this.dashCooldown > 0) this.dashCooldown--;
            
            for (let key in this.buffs) {
                this.buffs[key]--;
                if (this.buffs[key] <= 0) delete this.buffs[key];
            }
            
            for (let key in this.cooldowns) {
                if (this.cooldowns[key] > 0) this.cooldowns[key]--;
            }

            // Movement
            let currentSpeed = this.speed;
            if (this.buffs.speedBoost) currentSpeed *= 1.5;
            
            this.x += this.vx * (this.buffs.speedBoost ? 1.5 : 1);
            this.y += this.vy;
            
            // Gravity
            if (!this.onGround) {
                this.vy += 0.8;
            } else {
                this.vy = 0;
            }
            
            // Ground collision
            const groundY = canvas.height - this.height - 20;
            if (this.y >= groundY) {
                this.y = groundY;
                this.onGround = true;
                this.jumpPower = 0;
            } else {
                this.onGround = false;
            }
            
            // Boundaries
            this.x = Math.max(0, Math.min(canvas.width - this.width, this.x));
            this.y = Math.max(0, this.y);
            
            // Combo reset
            if (Date.now() - this.lastAttackTime > 2000) {
                this.combo = 0;
            }
        }

        draw() {
            ctx.fillStyle = 'rgba(0,0,0,0.5)';
            ctx.beginPath();
            ctx.ellipse(this.x + this.width/2, canvas.height - 15, 25, 10, 0, 0, Math.PI*2);
            ctx.fill();

            ctx.fillStyle = this.char.color;
            if (this.invuln > 0 && Math.floor(Date.now() / 100) % 2 === 0) ctx.fillStyle = '#fff'; 
            
            ctx.shadowBlur = 15;
            ctx.shadowColor = this.char.color;
            ctx.fillRect(this.x, this.y, this.width, this.height);
            ctx.shadowBlur = 0;

            ctx.font = '30px Arial';
            ctx.textAlign = 'center';
            ctx.fillText(this.char.icon, this.x + this.width/2, this.y + 40);

            if (this.stunned > 0) {
                ctx.font = '20px Arial';
                ctx.fillText('üí´', this.x + this.width/2, this.y - 10);
            }
            
            if (this.buffs.shield) {
                ctx.strokeStyle = '#00ffff';
                ctx.lineWidth = 3;
                ctx.beginPath();
                ctx.arc(this.x + this.width/2, this.y + this.height/2, 50, 0, Math.PI*2);
                ctx.stroke();
            }
        }

        takeDamage(amount, attacker) {
            if (this.invuln > 0) {
                spawnText(this.x, this.y, "MISS", "#ccc");
                return 0;
            }
            if (this.buffs.shield) {
                spawnText(this.x, this.y, "BLOCKED", "#00ffff");
                return 0;
            }
            
            // Damage reduction
            if (this.isPlayer) {
                amount *= (1 - playerStats.damageReduction);
            }
            
            this.health -= amount;
            if (this.health < 0) this.health = 0;
            spawnText(this.x, this.y, Math.floor(amount), "#ff0000");
            
            // Update combo
            if (attacker && attacker.isPlayer) {
                attacker.combo++;
                attacker.lastAttackTime = Date.now();
                updateComboDisplay(attacker.combo);
            }
            
            return amount;
        }

        dash() {
            if (this.dashCooldown > 0 || this.stunned > 0) return;
            
            this.vx = this.facing * this.speed * 3;
            this.invuln = 10;
            this.dashCooldown = 60;
            
            effects.push(new VisualEffect(this.x, this.y, 'dash', this.char.color, 40));
        }

        jump() {
            if (this.onGround && this.stunned === 0) {
                this.vy = -15;
                this.onGround = false;
            }
        }

        attack(type) {
            if (this.stunned > 0 || this.cooldowns[type] > 0) return;
            
            const move = this.char.moves[type];
            if (!move) return;

            if (type === 'ultimate') {
                if (this.ultimateCharge < 100) return;
                this.ultimateCharge = 0;
            }

            let cdReduction = this.isPlayer ? playerStats.cooldownReduction : 0;
            this.cooldowns[type] = (move.cd || 1) * 60 * (1 - cdReduction);

            // Show attack indicator
            showAttackIndicator(this, move);
            
            // Find target
            const targets = fighters.filter(f => f.isPlayer !== this.isPlayer && f.health > 0);
            targets.forEach(target => executeMove(this, target, move));
            
            if (type !== 'ultimate') {
                this.ultimateCharge = Math.min(100, this.ultimateCharge + (type === 'light' ? 5 : 12));
            }
        }
    }

    class Projectile {
        constructor(x, y, vx, vy, move, owner) {
            this.x = x; this.y = y; this.vx = vx; this.vy = vy;
            this.move = move; this.owner = owner;
            this.radius = 15;
            this.active = true;
            this.trail = [];
        }
        update() {
            this.trail.push({x: this.x, y: this.y});
            if (this.trail.length > 5) this.trail.shift();
            
            this.x += this.vx;
            this.y += this.vy;
            if (this.x < -100 || this.x > canvas.width + 100 || this.y < -100 || this.y > canvas.height + 100) {
                this.active = false;
            }
        }
        draw() {
            // Trail
            this.trail.forEach((t, i) => {
                ctx.globalAlpha = (i / this.trail.length) * 0.5;
                ctx.fillStyle = this.move.color;
                ctx.beginPath();
                ctx.arc(t.x, t.y, this.radius * (i / this.trail.length), 0, Math.PI*2);
                ctx.fill();
            });
            ctx.globalAlpha = 1;
            
            // Main
            ctx.fillStyle = this.move.color;
            ctx.shadowBlur = 20;
            ctx.shadowColor = this.move.color;
            ctx.beginPath();
            ctx.arc(this.x, this.y, this.radius, 0, Math.PI*2);
            ctx.fill();
            ctx.shadowBlur = 0;
        }
    }

    class VisualEffect {
        constructor(x, y, type, color, size) {
            this.x = x; this.y = y; this.type = type; this.color = color;
            this.life = 30;
            this.maxLife = 30;
            this.size = size || 40;
            this.rotation = Math.random() * Math.PI * 2;
        }
        update() { 
            this.life--;
            this.rotation += 0.1;
        }
        draw() {
            const alpha = this.life / this.maxLife;
            ctx.globalAlpha = alpha;
            ctx.fillStyle = this.color;
            
            if (this.type === 'impact') {
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.size * (1.5 - alpha), 0, Math.PI*2);
                ctx.fill();
                
                // Impact sparks
                for (let i = 0; i < 8; i++) {
                    const angle = (Math.PI * 2 / 8) * i + this.rotation;
                    const dist = this.size * (1 - alpha);
                    ctx.fillRect(
                        this.x + Math.cos(angle) * dist,
                        this.y + Math.sin(angle) * dist,
                        3, 3
                    );
                }
            } else if (this.type === 'slash') {
                ctx.save();
                ctx.translate(this.x, this.y);
                ctx.rotate(this.rotation);
                ctx.lineWidth = 5;
                ctx.strokeStyle = this.color;
                ctx.beginPath();
                ctx.moveTo(-40, -40);
                ctx.lineTo(40, 40);
                ctx.stroke();
                ctx.restore();
            } else if (this.type === 'dash') {
                ctx.fillStyle = this.color;
                for (let i = 0; i < 3; i++) {
                    ctx.globalAlpha = alpha * (1 - i/3);
                    ctx.fillRect(this.x - i*20, this.y, 10, this.size);
                }
            } else if (this.type === 'beam') {
                ctx.fillRect(0, this.y - 50, canvas.width, 100);
            } else if (this.type === 'domain_bg') {
                ctx.globalAlpha = 0.3 * alpha;
                ctx.fillRect(0, 0, canvas.width, canvas.height);
            }
            ctx.globalAlpha = 1;
        }
    }

    class DamageNumber {
        constructor(x, y, text, color) {
            this.x = x;
            this.y = y;
            this.text = text;
            this.color = color;
            this.life = 40;
            this.vx = (Math.random() - 0.5) * 2;
        }
        update() {
            this.y -= 2;
            this.x += this.vx;
            this.life--;
        }
        draw() {
            ctx.globalAlpha = this.life / 40;
            ctx.fillStyle = this.color;
            ctx.font = 'bold 24px Orbitron';
            ctx.strokeStyle = 'black';
            ctx.lineWidth = 3;
            ctx.strokeText(this.text, this.x, this.y);
            ctx.fillText(this.text, this.x, this.y);
            ctx.globalAlpha = 1;
        }
    }

    class SupportEntity {
        constructor(x, y, owner, color) {
            this.x = x; this.y = y; this.owner = owner; this.color = color;
            this.life = 180;
            this.angle = 0;
        }
        update() {
            this.life--;
            this.angle += 0.1;
            this.x = this.owner.x + this.owner.width/2 + Math.cos(this.angle) * 60;
            this.y = this.owner.y + this.owner.height/2 + Math.sin(this.angle) * 60;
            
            if (this.life % 60 === 0) {
                const targets = fighters.filter(f => f.isPlayer !== this.owner.isPlayer && f.health > 0);
                if (targets.length > 0) {
                    const target = targets[0];
                    const dx = target.x - this.x;
                    const speed = 10;
                    projectiles.push(new Projectile(
                        this.x, this.y,
                        (dx > 0 ? 1 : -1) * speed, 0,
                        {dmg: 15, color: this.color},
                        this.owner
                    ));
                }
            }
        }
        draw() {
            ctx.fillStyle = this.color;
            ctx.shadowBlur = 10;
            ctx.shadowColor = this.color;
            ctx.beginPath();
            ctx.arc(this.x, this.y, 10, 0, Math.PI*2);
            ctx.fill();
            ctx.shadowBlur = 0;
        }
    }

    // --- UTILITY FUNCTIONS ---
    function spawnText(x, y, text, color) {
        particles.push(new DamageNumber(x, y, text, color));
    }

    function showAttackIndicator(fighter, move) {
        const indicator = document.createElement('div');
        indicator.className = 'attack-indicator';
        indicator.style.left = fighter.x + 'px';
        indicator.style.top = fighter.y + 'px';
        indicator.style.color = move.color;
        indicator.innerHTML = move.name;
        document.body.appendChild(indicator);
        setTimeout(() => indicator.remove(), 300);
        
        // Highlight move slot
        const types = ['light', 'heavy', 'special1', 'special2', 'support', 'ultimate'];
        const moveType = Object.keys(fighter.char.moves).find(key => fighter.char.moves[key] === move);
        if (moveType) {
            const slot = document.getElementById(`slot-${moveType}`);
            if (slot) {
                slot.classList.add('active');
                setTimeout(() => slot.classList.remove('active'), 300);
            }
        }
    }

    function updateComboDisplay(combo) {
        if (combo <= 1) return;
        
        const display = document.getElementById('comboDisplay');
        display.textContent = `${combo} HIT COMBO!`;
        display.style.display = 'block';
        
        setTimeout(() => {
            display.style.display = 'none';
        }, 1000);
    }

    function triggerDomainExpansion(attacker, move) {
        domainActive = true;
        
        const overlay = document.getElementById('domainOverlay');
        const overlayText = document.getElementById('domainText');
        
        overlayText.innerText = move.name;
        overlayText.style.color = move.color;
        overlay.style.display = 'flex';
        
        document.getElementById('bgCanvas').style.background = attacker.char.domainColor || move.color;
        
        setTimeout(() => {
            overlay.style.display = 'none';
        }, 2500);
        
        // Domain effects
        const targets = fighters.filter(f => f.isPlayer !== attacker.isPlayer && f.health > 0);
        
        if (move.effect === 'stun' || move.effect === 'void') {
            targets.forEach(target => {
                target.stunned = 240;
                target.takeDamage(move.dmg, attacker);
            });
        } else if (move.effect === 'dot' || move.effect === 'burn_dot') {
            let ticks = 0;
            const interval = setInterval(() => {
                if(!gameActive) { clearInterval(interval); return; }
                targets.forEach(target => {
                    if (target.health > 0) {
                        target.takeDamage(move.dmg / 10, attacker);
                        effects.push(new VisualEffect(target.x + Math.random()*50, target.y + Math.random()*50, 'slash', move.color));
                    }
                });
                ticks++;
                if(ticks > 10) clearInterval(interval);
            }, 200);
        } else if (move.effect === 'instant_dmg' || move.effect === 'swords') {
            targets.forEach(target => {
                target.takeDamage(move.dmg, attacker);
                effects.push(new VisualEffect(target.x+20, target.y+40, 'impact', move.color, 100));
            });
        }

        setTimeout(() => {
            domainActive = false;
            if (selectedMap) {
                document.getElementById('bgCanvas').style.background = selectedMap.bgColor;
            }
        }, 3000);
    }

    function executeMove(attacker, target, move) {
        let dmg = move.dmg || 0;
        if (attacker.isPlayer) dmg *= playerStats.damageMultiplier;
        if (attacker.buffs.damageBoost) dmg *= 1.5;
        if (attacker.combo > 1) dmg *= (1 + attacker.combo * 0.05); // Combo scaling

        effects.push(new VisualEffect(attacker.x + attacker.width/2, attacker.y, 'cast', move.color));

        switch(move.type) {
            case 'melee':
                const range = move.range || 80;
                const dist = Math.abs((attacker.x + attacker.width/2) - (target.x + target.width/2));
                const yDist = Math.abs(attacker.y - target.y);
                
                if (dist < range && yDist < 100) {
                    const actualDmg = target.takeDamage(dmg, attacker);
                    if (actualDmg > 0) {
                        effects.push(new VisualEffect(target.x + target.width/2, target.y + target.height/2, move.slash ? 'slash' : 'impact', move.color));
                        if (move.knockback) {
                            target.vx = (attacker.x < target.x ? 1 : -1) * 15;
                        }
                        if (move.stun) target.stunned = 60 * move.stun;
                        if (move.dispel) target.buffs = {};
                        
                        if (attacker.isPlayer && playerStats.lifesteal > 0) {
                            attacker.health = Math.min(attacker.maxHealth, attacker.health + (actualDmg * playerStats.lifesteal));
                        }
                    }
                }
                break;
                
            case 'projectile':
                const count = move.multi || 1;
                for(let i=0; i<count; i++) {
                    setTimeout(() => {
                        const vy = (Math.random() - 0.5) * (count > 1 ? 4 : 0);
                        projectiles.push(new Projectile(
                            attacker.x + (attacker.facing * 40),
                            attacker.y + 40,
                            attacker.facing * 12,
                            vy,
                            {...move, dmg: dmg/count},
                            attacker
                        ));
                    }, i * 100);
                }
                break;
            
            case 'swap':
                if (fighters.length >= 2) {
                    const f1 = fighters[0];
                    const f2 = fighters[1];
                    const tempX = f1.x, tempY = f1.y;
                    f1.x = f2.x; f1.y = f2.y;
                    f2.x = tempX; f2.y = tempY;
                    spawnText(f1.x, f1.y, "CLAP!", "#ff69b4");
                }
                target.takeDamage(dmg, attacker);
                break;

            case 'teleport_attack':
            case 'teleport_blitz':
                attacker.x = target.x - (attacker.facing * 50);
                target.takeDamage(dmg, attacker);
                effects.push(new VisualEffect(target.x, target.y, 'impact', move.color));
                break;

            case 'beam':
                effects.push(new VisualEffect(canvas.width/2, canvas.height/2, 'beam', move.color));
                setTimeout(() => {
                    const actualDmg = target.takeDamage(dmg, attacker);
                    if (actualDmg > 0) spawnText(target.x, target.y, "HIT", move.color);
                }, 300);
                break;
                
            case 'domain':
                triggerDomainExpansion(attacker, move);
                break;
                
            case 'summon':
                supports.push(new SupportEntity(attacker.x, attacker.y, attacker, move.color));
                break;
                
            case 'buff':
                if (move.speedBoost) attacker.buffs.speedBoost = move.duration * 60;
                if (move.damageBoost) attacker.buffs.damageBoost = move.duration * 60;
                if (move.shield) attacker.buffs.shield = move.duration * 60;
                spawnText(attacker.x, attacker.y, "BUFF!", "#fff");
                break;

            case 'heal':
                attacker.health = Math.min(attacker.maxHealth, attacker.health + (move.amount || 50));
                spawnText(attacker.x, attacker.y, "+" + move.amount, "#00ff00");
                break;
                
            case 'stun':
                target.stunned = move.duration * 60;
                target.takeDamage(dmg, attacker);
                spawnText(target.x, target.y, "STUN", "#fff");
                break;

            case 'dodge':
                attacker.invuln = move.invuln * 60;
                spawnText(attacker.x, attacker.y, "DODGE", "#fff");
                break;
                
            case 'aoe':
                fighters.forEach(f => {
                    if (f.isPlayer !== attacker.isPlayer && f.health > 0) {
                        const dist = Math.hypot(f.x - attacker.x, f.y - attacker.y);
                        if (dist < (move.range || 150)) {
                            f.takeDamage(dmg, attacker);
                            effects.push(new VisualEffect(f.x, f.y, 'impact', move.color));
                        }
                    }
                });
                break;
        }
    }

    // --- MODE SELECTION ---
    function selectMode(mode) {
        gameMode = mode;
        document.getElementById('modeScreen').style.display = 'none';
        document.getElementById('selectionScreen').style.display = 'flex';
        
        const title = document.getElementById('selectionTitle');
        const desc = document.getElementById('selectionDesc');
        
        if (mode === '1v1') {
            title.textContent = 'SELECT YOUR CHARACTER';
            desc.textContent = 'Single battle duel';
        } else if (mode === '2v2') {
            title.textContent = 'SELECT YOUR TEAM (2 FIGHTERS)';
            desc.textContent = 'Player 1 and Player 2';
            document.getElementById('p2controls').style.display = 'inline';
        } else if (mode === 'tournament') {
            title.textContent = 'SELECT YOUR FIGHTER';
            desc.textContent = 'Fight through the tournament bracket';
        } else if (mode === 'endless' || mode === 'survival') {
            title.textContent = 'SELECT YOUR CHARACTER';
            desc.textContent = 'Survive as long as possible';
        }
    }

    function backToModes() {
        document.getElementById('selectionScreen').style.display = 'none';
        document.getElementById('modeScreen').style.display = 'flex';
        selectedChars = [];
        updateCharacterCards();
    }

    function confirmSelection() {
        if (gameMode === '2v2' && selectedChars.length < 2) {
            alert('Please select 2 characters for 2v2 mode!');
            return;
        }
        if (selectedChars.length === 0) {
            alert('Please select a character!');
            return;
        }
        
        document.getElementById('selectionScreen').style.display = 'none';
        document.getElementById('mapScreen').style.display = 'flex';
    }

    function backToSelection() {
        document.getElementById('mapScreen').style.display = 'none';
        document.getElementById('selectionScreen').style.display = 'flex';
        selectedMap = null;
    }

    // --- CHARACTER SELECTION ---
    function initCharacterSelection() {
        const container = document.getElementById('charactersContainer');
        container.innerHTML = '';
        
        CHARACTERS.forEach(char => {
            const card = document.createElement('div');
            card.className = 'character-card';
            card.id = `char-${char.id}`;
            
            let domainBadge = '';
            if (char.moves.ultimate && char.moves.ultimate.type === 'domain') {
                domainBadge = `<div class="domain-badge">DOMAIN</div>`;
            }

            card.innerHTML = `
                ${domainBadge}
                <div class="character-portrait">${char.icon}</div>
                <div class="character-name">${char.name}</div>
                <div class="character-title">${char.title}</div>
            `;
            
            card.onclick = () => selectCharacter(char);
            container.appendChild(card);
        });
    }

    function selectCharacter(char) {
        if (gameMode === '2v2') {
            if (selectedChars.length < 2) {
                if (!selectedChars.find(c => c.id === char.id)) {
                    selectedChars.push(char);
                }
            }
        } else {
            selectedChars = [char];
        }
        updateCharacterCards();
    }

    function updateCharacterCards() {
        CHARACTERS.forEach(char => {
            const card = document.getElementById(`char-${char.id}`);
            if (card) {
                if (selectedChars.find(c => c.id === char.id)) {
                    card.classList.add('selected');
                } else {
                    card.classList.remove('selected');
                }
            }
        });
    }

    // --- MAP SELECTION ---
    function initMapSelection() {
        const container = document.getElementById('mapsContainer');
        container.innerHTML = '';
        
        MAPS.forEach(map => {
            const card = document.createElement('div');
            card.className = 'map-card';
            card.id = `map-${map.id}`;
            card.innerHTML = `
                <div class="map-preview">${map.icon}</div>
                <div class="map-name">${map.name}</div>
            `;
            card.onclick = () => selectMap(map);
            container.appendChild(card);
        });
    }

    function selectMap(map) {
        selectedMap = map;
        MAPS.forEach(m => {
            const card = document.getElementById(`map-${m.id}`);
            if (card) {
                card.classList.toggle('selected', m.id === map.id);
            }
        });
    }

    // --- GAME START ---
    function startBattle() {
        if (!selectedMap) {
            alert('Please select a map!');
            return;
        }
        
        document.getElementById('mapScreen').style.display = 'none';
        document.getElementById('gameScreen').style.display = 'block';
        
        // Apply map colors
        document.getElementById('bgCanvas').style.background = selectedMap.bgColor;
        
        initGame();
    }

    function initGame() {
        fighters = [];
        projectiles = [];
        effects = [];
        particles = [];
        supports = [];
        
        if (gameMode === '1v1') {
            fighters.push(new Fighter(100, 300, selectedChars[0], true, 1));
            const enemyChar = CHARACTERS[Math.floor(Math.random() * CHARACTERS.length)];
            fighters.push(new Fighter(1000, 300, enemyChar, false));
        } else if (gameMode === '2v2') {
            fighters.push(new Fighter(100, 300, selectedChars[0], true, 1));
            fighters.push(new Fighter(150, 300, selectedChars[1], true, 2));
            const enemy1 = CHARACTERS[Math.floor(Math.random() * CHARACTERS.length)];
            const enemy2 = CHARACTERS[Math.floor(Math.random() * CHARACTERS.length)];
            fighters.push(new Fighter(1000, 300, enemy1, false));
            fighters.push(new Fighter(1050, 300, enemy2, false));
        } else if (gameMode === 'tournament') {
            initTournament();
            return;
        } else if (gameMode === 'endless' || gameMode === 'survival') {
            fighters.push(new Fighter(100, 300, selectedChars[0], true, 1));
            const enemyChar = CHARACTERS[Math.floor(Math.random() * CHARACTERS.length)];
            fighters.push(new Fighter(1000, 300, enemyChar, false));
        }
        
        setupHealthBars();
        setupMovesUI();
        gameActive = true;
        gameLoop();
    }

    function initTournament() {
        const shuffled = [...CHARACTERS].sort(() => Math.random() - 0.5);
        tournamentBracket = shuffled.slice(0, 8).map(char => ({
            char: char,
            wins: 0
        }));
        currentTournamentMatch = 0;
        
        showTournamentBracket();
    }

    function showTournamentBracket() {
        const overlay = document.getElementById('tournamentOverlay');
        const bracket = document.getElementById('tournamentBracket');
        bracket.innerHTML = '';
        
        for (let i = 0; i < tournamentBracket.length; i += 2) {
            const match = document.createElement('div');
            match.className = 'bracket-match';
            if (i === currentTournamentMatch) match.classList.add('current');
            if (i < currentTournamentMatch) match.classList.add('completed');
            
            match.innerHTML = `
                <strong>Match ${i/2 + 1}:</strong> 
                ${tournamentBracket[i].char.name} vs ${tournamentBracket[i+1].char.name}
            `;
            bracket.appendChild(match);
        }
        
        overlay.style.display = 'block';
    }

    function nextTournamentMatch() {
        document.getElementById('tournamentOverlay').style.display = 'none';
        
        const p1Char = selectedChars[0];
        const enemyChar = tournamentBracket[currentTournamentMatch + 1].char;
        
        fighters = [];
        fighters.push(new Fighter(100, 300, p1Char, true, 1));
        fighters.push(new Fighter(1000, 300, enemyChar, false));
        
        setupHealthBars();
        setupMovesUI();
        gameActive = true;
        gameLoop();
    }

    // --- UI SETUP ---
    function setupHealthBars() {
        const container = document.getElementById('healthBarsContainer');
        container.innerHTML = '';
        
        fighters.forEach((fighter, idx) => {
            const group = document.createElement('div');
            group.className = 'health-group';
            
            const barClass = fighter.isPlayer ? 
                (fighter.playerNumber === 1 ? 'player' : 'player2') : 
                (idx === 2 ? 'enemy' : 'enemy2');
            
            group.innerHTML = `
                <div class="health-label">
                    <span id="name-${idx}">${fighter.char.name}</span>
                    <span id="hp-${idx}">100/100</span>
                </div>
                <div class="health-bar-outer">
                    <div class="health-bar-inner ${barClass}" id="healthbar-${idx}" style="width: 100%"></div>
                </div>
                <div class="ultimate-bar-outer"><div class="ultimate-bar-inner" id="ultbar-${idx}"></div></div>
            `;
            container.appendChild(group);
        });
    }

    function setupMovesUI() {
        const bar = document.getElementById('movesBar');
        bar.innerHTML = '';
        
        if (!fighters[0]) return;
        
        const char = fighters[0].char;
        const keysMap = ['J', 'K', 'U', 'I', 'O', 'P'];
        const types = ['light', 'heavy', 'special1', 'special2', 'support', 'ultimate'];
        
        types.forEach((type, i) => {
            const move = char.moves[type];
            const div = document.createElement('div');
            div.className = 'move-slot';
            div.id = `slot-${type}`;
            div.innerHTML = `
                <div class="move-name">${move.name}</div>
                <div class="move-slot-key">${keysMap[i]}</div>
            `;
            bar.appendChild(div);
        });
    }

    // --- AI ---
    function enemyAI(enemy) {
        if (!gameActive || enemy.stunned > 0 || enemy.health <= 0) return;
        
        const playerFighters = fighters.filter(f => f.isPlayer && f.health > 0);
        if (playerFighters.length === 0) return;
        
        const target = playerFighters[0];
        const dist = target.x - enemy.x;
        const absDist = Math.abs(dist);
        
        // Movement
        if (absDist > 100) {
            enemy.vx = (dist > 0 ? 1 : -1) * enemy.speed * 0.5;
            enemy.facing = dist > 0 ? 1 : -1;
        } else {
            enemy.vx = 0;
        }
        
        // Attack decision
        if (Math.random() < 0.02) {
            const moves = Object.keys(enemy.char.moves);
            const availableMoves = moves.filter(m => enemy.cooldowns[m] === 0);
            if (availableMoves.length > 0) {
                const randomMove = availableMoves[Math.floor(Math.random() * availableMoves.length)];
                enemy.attack(randomMove);
            }
        }
        
        // Jump occasionally
        if (Math.random() < 0.01 && enemy.onGround) {
            enemy.jump();
        }
    }

    // --- GAME LOOP ---
    function gameLoop() {
        if (!gameActive) return;
        
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        
        // Draw ground
        if (selectedMap) {
            ctx.fillStyle = selectedMap.floorColor;
            ctx.fillRect(0, canvas.height - 20, canvas.width, 20);
        }
        
        // Player 1 input
        if (fighters[0] && fighters[0].isPlayer) {
            const p1 = fighters[0];
            p1.vx = 0;
            if (keys['w']) p1.jump();
            if (keys['s']) p1.vy += 1;
            if (keys['a']) { p1.vx = -p1.speed; p1.facing = -1; }
            if (keys['d']) { p1.vx = p1.speed; p1.facing = 1; }
        }
        
        // Player 2 input (2v2 mode)
        if (fighters[1] && fighters[1].isPlayer && fighters[1].playerNumber === 2) {
            const p2 = fighters[1];
            p2.vx = 0;
            if (keys['arrowup']) p2.jump();
            if (keys['arrowdown']) p2.vy += 1;
            if (keys['arrowleft']) { p2.vx = -p2.speed; p2.facing = -1; }
            if (keys['arrowright']) { p2.vx = p2.speed; p2.facing = 1; }
        }
        
        // Update all fighters
        fighters.forEach(f => {
            f.update();
            if (!f.isPlayer) enemyAI(f);
        });
        
        // Projectiles
        projectiles = projectiles.filter(p => {
            p.update();
            p.draw();
            
            const targets = fighters.filter(f => f.isPlayer !== p.owner.isPlayer && f.health > 0);
            for (let target of targets) {
                const dx = p.x - (target.x + target.width/2);
                const dy = p.y - (target.y + target.height/2);
                if (Math.abs(dx) < target.width/2 + p.radius && Math.abs(dy) < target.height/2 + p.radius) {
                    target.takeDamage(p.move.dmg, p.owner);
                    effects.push(new VisualEffect(p.x, p.y, 'impact', p.move.color));
                    return false;
                }
            }
            return p.active;
        });
        
        // Effects & Particles
        effects = effects.filter(e => { e.update(); e.draw(); return e.life > 0; });
        particles = particles.filter(p => { p.update(); p.draw(); return p.life > 0; });
        supports = supports.filter(s => { s.update(); s.draw(); return s.life > 0; });
        
        // Draw fighters
        fighters.forEach(f => f.draw());
        
        updateUI();
        checkGameOver();
        
        requestAnimationFrame(gameLoop);
    }

    function updateUI() {
        fighters.forEach((f, idx) => {
            const pct = (f.health / f.maxHealth) * 100;
            const bar = document.getElementById(`healthbar-${idx}`);
            const hpText = document.getElementById(`hp-${idx}`);
            if (bar) bar.style.width = `${Math.max(0, pct)}%`;
            if (hpText) hpText.innerText = `${Math.ceil(f.health)}/${f.maxHealth}`;
            
            const ultBar = document.getElementById(`ultbar-${idx}`);
            if (ultBar) ultBar.style.width = `${f.ultimateCharge}%`;
        });
        
        document.getElementById('coinsDisplay').innerText = `üí∞ ${coins}`;
        document.getElementById('roundInfo').innerText = gameMode === 'tournament' ? 
            `TOURNAMENT - MATCH ${currentTournamentMatch/2 + 1}` : 
            `ROUND ${currentRound}`;
        
        // Cooldown visualization
        if (fighters[0]) {
            for(let key in fighters[0].cooldowns) {
                const slot = document.getElementById(`slot-${key}`);
                if (slot) {
                    if (fighters[0].cooldowns[key] > 0) slot.classList.add('cooldown');
                    else slot.classList.remove('cooldown');

                    if (key === 'ultimate' && fighters[0].ultimateCharge >= 100) {
                        slot.classList.add('ready-ult');
                    } else {
                        slot.classList.remove('ready-ult');
                    }
                }
            }
        }
    }

    function checkGameOver() {
        const playersAlive = fighters.filter(f => f.isPlayer && f.health > 0);
        const enemiesAlive = fighters.filter(f => !f.isPlayer && f.health > 0);
        
        if (enemiesAlive.length === 0) {
            gameActive = false;
            
            if (gameMode === '1v1') {
                showVictory();
            } else if (gameMode === 'tournament') {
                currentTournamentMatch += 2;
                if (currentTournamentMatch >= tournamentBracket.length) {
                    showTournamentVictory();
                } else {
                    showTournamentBracket();
                }
            } else if (gameMode === 'endless' || gameMode === 'survival') {
                coins += 50 + (currentRound * 10);
                openShop();
            } else if (gameMode === '2v2') {
                showVictory();
            }
        } else if (playersAlive.length === 0) {
            gameActive = false;
            showDefeat();
        }
    }

    function showVictory() {
        document.getElementById('gameOverTitle').innerText = 'VICTORY!';
        document.getElementById('gameOverText').innerText = `You dominated ${gameMode.toUpperCase()} mode!`;
        document.getElementById('gameOver').style.display = 'block';
    }

    function showDefeat() {
        document.getElementById('gameOverTitle').innerText = 'EXORCISED';
        let text = `You survived until Round ${currentRound}`;
        if (gameMode === 'tournament') text = `Eliminated in Match ${currentTournamentMatch/2 + 1}`;
        document.getElementById('gameOverText').innerText = text;
        document.getElementById('gameOver').style.display = 'block';
    }

    function showTournamentVictory() {
        document.getElementById('gameOverTitle').innerText = 'TOURNAMENT CHAMPION!';
        document.getElementById('gameOverText').innerText = 'You conquered the entire tournament!';
        document.getElementById('gameOver').style.display = 'block';
    }

    function openShop() {
        const shop = document.getElementById('shopScreen');
        const list = document.getElementById('shopItems');
        list.innerHTML = '';
        
        SHOP_ITEMS.forEach(item => {
            const div = document.createElement('div');
            div.className = 'shop-item';
            div.innerHTML = `
                <div style="font-size:2em">${item.icon}</div>
                <div><b>${item.name}</b></div>
                <div style="color:#ffd700">${item.price} üí∞</div>
            `;
            div.onclick = () => {
                if (coins >= item.price) {
                    coins -= item.price;
                    if (item.effect === 'maxHealth') {
                        playerStats.maxHealth += item.value;
                    } else {
                        playerStats[item.effect] += item.value;
                    }
                    item.price = Math.floor(item.price * 1.3);
                    openShop();
                }
            };
            list.appendChild(div);
        });
        
        shop.style.display = 'block';
    }

    function closeShop() {
        document.getElementById('shopScreen').style.display = 'none';
        currentRound++;
        initGame();
    }

    // --- INPUT HANDLING ---
    window.addEventListener('keydown', e => {
        keys[e.key.toLowerCase()] = true;
        
        if (!gameActive) return;
        
        // Player 1 controls
        if (fighters[0] && fighters[0].isPlayer) {
            const k = e.key.toLowerCase();
            if (k === 'j') fighters[0].attack('light');
            if (k === 'k') fighters[0].attack('heavy');
            if (k === 'u') fighters[0].attack('special1');
            if (k === 'i') fighters[0].attack('special2');
            if (k === 'o') fighters[0].attack('support');
            if (k === 'p') fighters[0].attack('ultimate');
            if (k === ' ') fighters[0].dash();
        }
        
        // Player 2 controls (2v2 mode)
        if (fighters[1] && fighters[1].isPlayer && fighters[1].playerNumber === 2) {
            if (e.key === 'Numpad1') fighters[1].attack('light');
            if (e.key === 'Numpad2') fighters[1].attack('heavy');
            if (e.key === 'Numpad4') fighters[1].attack('special1');
            if (e.key === 'Numpad5') fighters[1].attack('special2');
            if (e.key === 'Numpad7') fighters[1].attack('support');
            if (e.key === 'Numpad8') fighters[1].attack('ultimate');
            if (e.key === 'Numpad0') fighters[1].dash();
        }
    });

    window.addEventListener('keyup', e => {
        keys[e.key.toLowerCase()] = false;
    });

    // --- BACKGROUND ANIMATION ---
    function initBackgroundAnimation() {
        const bgCanvas = document.getElementById('bgCanvas');
        const bgCtx = bgCanvas.getContext('2d');
        bgCanvas.width = window.innerWidth;
        bgCanvas.height = window.innerHeight;
        
        const particles = Array(50).fill().map(() => ({
            x: Math.random() * bgCanvas.width,
            y: Math.random() * bgCanvas.height,
            vx: (Math.random() - 0.5),
            vy: (Math.random() - 0.5),
            size: Math.random() * 3
        }));
        
        function animate() {
            if (domainActive) return requestAnimationFrame(animate);
            
            bgCtx.clearRect(0, 0, bgCanvas.width, bgCanvas.height);
            bgCtx.fillStyle = 'rgba(255, 8, 68, 0.2)';
            
            particles.forEach(p => {
                p.x += p.vx;
                p.y += p.vy;
                if (p.x < 0 || p.x > bgCanvas.width) p.vx *= -1;
                if (p.y < 0 || p.y > bgCanvas.height) p.vy *= -1;
                bgCtx.beginPath();
                bgCtx.arc(p.x, p.y, p.size, 0, Math.PI*2);
                bgCtx.fill();
            });
            
            requestAnimationFrame(animate);
        }
        animate();
    }

    // --- INITIALIZATION ---
    initCharacterSelection();
    initMapSelection();
    initBackgroundAnimation();
</script>
</body>
</html>
